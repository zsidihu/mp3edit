!function(t){!function require(e){var i={exports:{}};return t[e][0].call(i.exports,function(i){return require(t[e][1][i])},i,i.exports),i.exports}(2)}({1:[function(t,e,i){"use strict";const a=["rect","circle","ellipse","line","polyline","polygon","path","text","tspan","textPath","svg","g","defs","use","symbol","style","clipPath","mask","filter","pattern","linearGradient","radialGradient","title","desc","image"],n={$:document.querySelector.bind(document),$$:document.querySelectorAll.bind(document),cE(t,e={}){const i=a.includes(t)?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t);for(const[t,a]of Object.entries(e))null!=a&&i.setAttribute(t,a);return i},addClass(t,...e){const i=t instanceof Element?t:this.$(t);i?.classList.add(...e)},remClass(t,...e){const i=t instanceof Element?t:this.$(t);i?.classList.remove(...e)},addClassAll(t,...e){this.$$(t).forEach(t=>t.classList.add(...e))},remClassAll(t,...e){this.$$(t).forEach(t=>t.classList.remove(...e))},attr(t,e,i){const a=t instanceof Element?t:this.$(t);if(a)return void 0===i?a.getAttribute(e):void a.setAttribute(e,i)},css(t,e,i){const a=t instanceof Element?t:this.$(t);a&&("string"==typeof e&&void 0!==i?a.style[e]=i:"object"==typeof e&&Object.assign(a.style,e))},html(t,e){const i=t instanceof Element?t:this.$(t);if(i)return void 0===e?i.innerHTML:void(i.innerHTML=e)},text(t,e){const i=t instanceof Element?t:this.$(t);if(i)return void 0===e?i.textContent:void(i.textContent=e)},on(t,e,i,a){const n=t instanceof Element||t instanceof Document||t===window?t:this.$(t);n?.addEventListener(e,i,a)},off(t,e,i,a){const n=t instanceof Element||t instanceof Document||t===window?t:this.$(t);n?.removeEventListener(e,i,a)}};class FFmpegHelper{ffmpegCore=null;ffmpegRunning=!1;ffmpegCurrentDuration=null;ffmpegLogContent=null;ffmpegLogEmptyCount=0;ffmpegDurationHandler=null;ffmpegProgressHandler=null;ffmpegLogHandler=null;handleFFmpegOutput=(t,e)=>{null!=this.ffmpegLogHandler&&this.ffmpegLogHandler(t,e),this.detectDuration(e),this.detectProgress(e),this.detectCompletion(e)};initialzeFFmpeg=async()=>{await createFFmpegCore({print:t=>{this.handleFFmpegOutput("stdout",t)},printErr:t=>{this.handleFFmpegOutput("stdout",t)}}).then(async t=>{this.ffmpegCore=t})};inSeconds=t=>3600*parseFloat(t[1])+60*parseFloat(t[2])+parseFloat(t[3])+1e3*parseFloat("0."+t[4])/1e3;detectProgress=t=>{var e=t.match(/.*time.(\d\d).(\d\d).(\d\d).(\d+).*/m);if(null!=e){var i=this.inSeconds(e),a=i;return null!=this.ffmpegCurrentDuration&&(a=~~(i/this.ffmpegCurrentDuration*100)),null!=this.ffmpegProgressHandler&&this.ffmpegProgressHandler(a),i}};FS=()=>this.ffmpegCore.FS;detectDuration=t=>{var e=t.match(/.*Duration..(\d\d).(\d\d).(\d\d).(\d+).*/m);if(null!=e){var i=this.inSeconds(e);return null!=this.ffmpegDurationHandler&&this.ffmpegDurationHandler(i),this.ffmpegCurrentDuration=i,i}};detectCompletion=t=>{(t.includes("kB muxing overhead")||t.includes("Invalid argument")||t.includes("Invalid data found")||t.includes("At least one output file"))&&null!==this.runResolve&&(this.runResolve(),this.runResolve=null,this.ffmpegLogEmptyCount=0,this.ffmpegRunning=!1,this.ffmpegCurrentDuration=null,null!=this.ffmpegProgressHandler&&this.ffmpegProgressHandler(100))};run=t=>{if(t=["-y","-hide_banner","-stats_period","0.2","-loglevel","info","-nostdin",...t],this.ffmpegRunning)throw Error("ffmpeg.wasm can only run one command at a time");return this.ffmpegRunning=!0,new Promise(e=>{this.runResolve=e,this.ffmpegCore.callMain(t)})}}var s,o={getInstance:function(){return s||(s=function createInstance(){var t=new FFmpegHelper;return t.initialzeFFmpeg(),t}()),s}};e.exports={Attach:(t,e)=>{for(let i in e)t.appendChild(e[i])},Elem:n,FFmpegSingleton:o,ScrollController:class ScrollController{constructor(t,e={}){this.container=t,this.ease=e.ease||.1,this.targetScrollTop=this.container.scrollTop,this.currentScrollTop=this.container.scrollTop,this.scrolling=!1,this.onWheel=this.onWheel.bind(this),this.animate=this.animate.bind(this),this.container.addEventListener("wheel",this.onWheel,{passive:!1})}onWheel(t){if(this.isInsideAnotherScrollable(t.target))return;t.preventDefault(),this.targetScrollTop+=t.deltaY;const e=this.container.scrollHeight-this.container.clientHeight;this.targetScrollTop=Math.max(0,Math.min(e,this.targetScrollTop)),this.scrolling||(this.scrolling=!0,requestAnimationFrame(this.animate))}animate(){const t=this.targetScrollTop-this.currentScrollTop;Math.abs(t)>.5?(this.currentScrollTop+=t*this.ease,this.container.scrollTop=this.currentScrollTop,requestAnimationFrame(this.animate)):(this.container.scrollTop=this.targetScrollTop,this.currentScrollTop=this.targetScrollTop,this.scrolling=!1)}isInsideAnotherScrollable(t){let e=t;for(;e&&e!==this.container;){const t=getComputedStyle(e).overflowY;if(("auto"===t||"scroll"===t)&&e.scrollHeight>e.clientHeight)return!0;e=e.parentElement}return!1}},isSuppoted:t=>{if(!t)return!1;const e={mp3:"audio/mpeg",wav:"audio/wav",ogg:'audio/ogg; codecs="vorbis"',aac:'audio/mp4; codecs="mp4a.40.2"',m4a:'audio/mp4; codecs="mp4a.40.2"',flac:"audio/flac",opus:'audio/ogg; codecs="opus"'}[t.split(".").pop().toLowerCase()];if(!e)return!1;const i=document.createElement("audio").canPlayType(e);return"probably"===i||"maybe"===i},TouchDevice:()=>{let t=!1;var e;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t}}},{}],2:[function(t,e,i){"use strict";const{Attach:a,Elem:n,FFmpegSingleton:s,ScrollController:o,isSuppoted:c,TouchDevice:l}=t("./a.js"),openDB=async()=>new Promise(t=>{const e=indexedDB.open("player-handles",1);e.onupgradeneeded=t=>t.target.result.createObjectStore("dirs"),e.onsuccess=()=>t(e.result)}),r=new(window.AudioContext||window.webkitAudioContext),d=n.$("#tracks"),m=n.$("#album-artist"),u=n.$("#album-title"),h=n.$("#track-title"),p=n.$("#cover"),w=n.$("audio"),f=n.$("canvas"),v=f.getContext("2d");let g=null,b=null,y=0,k=null,x=!1;const F={repeat:!1,shuffle:!1},M=r.createMediaElementSource(w),A=r.createAnalyser(),C={light:n.$("#theme-light"),dark:n.$("#theme-dark"),used:"theme-dark"},UpdateHeight=()=>{const t=window.innerHeight+"px";document.documentElement.style.height=t,document.body.style.height=t};let E=null,D=null,S=[];const drawBarLight=(t,e,i,a,n,s,o,c)=>{const l=(360*o/c+.002*performance.now())%360,r=v.createLinearGradient(t,e,i,a);r.addColorStop(0,`hsl(${l}, 80%, 45%)`),r.addColorStop(.5,`hsl(${(l+40)%360}, 80%, 50%)`),r.addColorStop(1,`hsl(${(l+80)%360}, 80%, 55%)`),v.strokeStyle=r,v.lineWidth=n,v.beginPath(),v.moveTo(t,e),v.lineTo(i,a),v.stroke()},drawBarDark=(t,e,i,a,n,s,o,c)=>{let l=v.createLinearGradient(0,0,0,f.height);l.addColorStop(0,"#37FF8B"),l.addColorStop(1,"#51D6FF"),v.strokeStyle=l,v.lineWidth=n,v.beginPath(),v.moveTo(t,e),v.lineTo(i,a),v.stroke()},visualizer=()=>{const t=f.width/2,e=f.height/2;v.clearRect(0,0,f.width,f.height),A.getByteFrequencyData(D);const i=120;for(let a=0;a<i;a++){const n=2*Math.PI/i,s=.15*D[a],o=t+60*Math.cos(n*a),c=e+60*Math.sin(n*a),l=t+Math.cos(n*a)*(60+s),r=e+Math.sin(n*a)*(60+s);"theme-light"==C.used?drawBarLight(o,c,l,r,3,D[a],a,i):drawBarDark(o,c,l,r,3,D[a])}x&&requestAnimationFrame(visualizer)},toggleMenu=t=>{const e=n.$("#open-menu");"auto"===t&&(e.classList.toggle("opened"),e.setAttribute("aria-expanded",e.classList.contains("opened"))),"close"===t&&(n.remClass(e,"opened"),e.setAttribute("aria-expanded",!1)),e.classList.contains("opened")?n.addClass("section","visible"):n.remClass("section","visible")},scanAndShow=async(t,e="name")=>{d.replaceChildren(),S=[];for await(const e of t.values())if("file"===e.kind&&/\.(mp3|m4a|flac|alac|ogg|opus|wav|wma|wv)$/i.test(e.name)){const t=await e.getFile();S.push({entry:e,file:t})}switch(e){case"name":S.sort((t,e)=>t.file.name.localeCompare(e.file.name));break;case"date":S.sort((t,e)=>e.file.lastModified-t.file.lastModified);break;case"size":S.sort((t,e)=>t.file.size-e.file.size)}for(const[t,{entry:e,file:i}]of S.entries()){const a=i.name.replace(/\.[^.]+$/,""),s=n.cE("div",{class:"track","data-index":t,"data-text":a});s.addEventListener("click",async a=>{b&&n.remClass(b,"active"),n.addClass(s,"active"),b=s,y=t,await playFile(i,e.name)}),d.appendChild(s)}b&&n.remClass(b,"active"),b=null,y=0,g=new o(d,{ease:.05}),w.pause(),w.currentTime=0,setTimeout(()=>v.clearRect(0,0,f.width,f.height),100)},playNext=async()=>{if(y<S.length-1){F.repeat||(F.shuffle?y=Math.floor(Math.random()*S.length):++y);const{entry:t,file:e}=S[y],i=n.$('[data-index="'+y+'"]');b&&n.remClass(b,"active"),n.addClass(i,"active"),b=i,await playFile(e,t.name)}else b&&n.remClass(b,"active"),b=null,y=0,w.pause(),w.currentTime=0,setTimeout(()=>v.clearRect(0,0,f.width,f.height),100)},playFile=async(t,e)=>{const i=t.urn||t.name;if(ID3.loadTags(i,function(){const t=ID3.getAllTags(i);if(m.textContent=t.artist?t.artist:"",u.textContent=t.album?t.album:"",h.textContent=t.title?t.title:e.replace(/\.[^.]+$/,""),t.picture){let e="";for(var a=0;a<t.picture.data.length;a++)e+=String.fromCharCode(t.picture.data[a]);p.src="data:"+t.picture.format+";base64,"+window.btoa(e)}else p.src="../assets/images/cover.png"},{tags:["title","artist","album","picture"],dataReader:ID3.FileAPIReader(t)}),c(e))w.onended=async()=>{x=!1,await playNext()},w.src=URL.createObjectURL(t),x=!0,M.connect(A),A.connect(r.destination),E=A.frequencyBinCount,D=new Uint8Array(E),"suspended"===r.state&&await r.resume(),f.width=240,f.height=240,visualizer(),w.play();else try{const e=await t.arrayBuffer(),i=s.getInstance();await i.initialzeFFmpeg();const a=["-i",t.name,"-vn","-codec:a","pcm_s16le","-f","wav","output.wav"];i.FS().writeFile(t.name,new Uint8Array(e)),await i.run(a);const n=i.FS().readFile("output.wav"),o=new Blob([n],{type:"audio/wav"});w.onended=async()=>{x=!1,await playNext()},w.src=URL.createObjectURL(o),x=!0,M.connect(A),A.connect(r.destination),E=A.frequencyBinCount,D=new Uint8Array(E),"suspended"===r.state&&await r.resume(),f.width=240,f.height=240,visualizer(),w.play()}catch(t){}};document.querySelectorAll("a").forEach(async t=>{t.addEventListener("click",async t=>{switch(t.target.id&&t.preventDefault(),t.target.id){case"open-menu":toggleMenu("auto");break;case"clear-playlist":try{const t=(await openDB()).transaction("dirs","readwrite");t.objectStore("dirs").delete("playlist"),await new Promise(e=>t.oncomplete=e),b&&n.remClass(b,"active"),b=null,y=0,w.pause(),w.removeAttribute("src"),w.load(),setTimeout(()=>v.clearRect(0,0,f.width,f.height),100),d.replaceChildren(),S=null}catch(t){}break;case"theme-light":case"theme-dark":Object.values(C).forEach(e=>{e===t.target?n.addClass(e,"active"):n.remClass(e,"active")}),document.documentElement.setAttribute("data-theme",t.target.id),C.used=t.target.id,localStorage.setItem("theme",t.target.id);break;case"about-player":toggleMenu("close"),n.addClass(".version","visible");break;case"pick-folder":try{const t=await window.showDirectoryPicker(),e=(await openDB()).transaction("dirs","readwrite");e.objectStore("dirs").put(t,"playlist"),await new Promise(t=>e.oncomplete=t),await scanAndShow(t)}catch(t){}break;case"play-prev":x&&await(async()=>{if(!F.repeat)if(y>0){const{entry:t,file:e}=S[--y],i=n.$('[data-index="'+y+'"]');b&&n.remClass(b,"active"),n.addClass(i,"active"),b=i,await playFile(e,t.name)}else b&&n.remClass(b,"active"),b=null,y=0,w.pause(),w.currentTime=0,setTimeout(()=>v.clearRect(0,0,f.width,f.height),100)})();break;case"play-repeat":t.target.classList.toggle("active"),F.repeat=!!t.target.classList.contains("active");break;case"play-shuffle":t.target.classList.toggle("active"),F.shuffle=!!t.target.classList.contains("active");break;case"play-next":x&&await playNext()}})}),document.addEventListener("click",t=>{const e=t.target.getAttribute("aria-label")??null;"Main Menu"!==e&&"Menu Item"!==e&&toggleMenu("close"),"About Box"!==e&&"Main Menu"!==e&&"Menu Item"!==e&&n.remClass(".version","visible")}),window.addEventListener("resize",UpdateHeight),async function(){if(UpdateHeight(),!("showDirectoryPicker"in window)){const t=n.$(".confirm"),e=n.cE("p",{"data-text":"Not support directory access."}),i=n.cE("a",{href:"#","data-text":"Ok"}),a=n.cE("div");return t.replaceChildren(),i.addEventListener("click",t=>{t.preventDefault(),n.remClass(".confirm","visible")}),a.appendChild(i),t.appendChild(e),t.appendChild(a),void n.addClass(".confirm","visible")}"theme-light"===(localStorage.getItem("theme")??null)&&(n.addClass(C.light,"active"),n.remClass(C.dark,"active"),C.used="theme-light",document.documentElement.setAttribute("data-theme","theme-light"));const t=(await openDB()).transaction("dirs","readonly").objectStore("dirs").get("playlist");if(k=await new Promise(e=>{t.onsuccess=()=>e(t.result)}),k)try{if("granted"===await k.queryPermission({mode:"read"}))await scanAndShow(k);else{const t=n.$(".confirm"),e=n.cE("p",{"data-text":"Allow access to your files?"}),i=n.cE("a",{href:"#","data-text":"Allow"}),a=n.cE("a",{href:"#","data-text":"Cancel"}),s=n.cE("div");t.replaceChildren(),i.addEventListener("click",async t=>{t.preventDefault();try{"granted"===await k.requestPermission({mode:"read"})?await scanAndShow(k):alert("EngedÃ©ly megtagadva"),n.remClass(".confirm","visible")}catch(t){console.error(t)}}),a.addEventListener("click",t=>{t.preventDefault(),n.remClass(".confirm","visible")}),s.appendChild(i),s.appendChild(a),t.appendChild(e),t.appendChild(s),n.addClass(".confirm","visible")}}catch(t){console.error(t)}}()},{"./a.js":1,"./b.js":2}]});