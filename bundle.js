const audioContext=new(window.AudioContext||window.webkitAudioContext);!function(t){!function require(e){var n={exports:{}};return t[e][0].call(n.exports,function(n){return require(t[e][1][n])},n,n.exports),n.exports}(4)}({1:[function(t,e,n){"use strict";const o=["rect","circle","ellipse","line","polyline","polygon","path","text","tspan","textPath","svg","g","defs","use","symbol","style","clipPath","mask","filter","pattern","linearGradient","radialGradient","title","desc","image"],i={$:document.querySelector.bind(document),$$:document.querySelectorAll.bind(document),cE(t,e={}){const n=o.includes(t)?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t);for(const[t,o]of Object.entries(e))null!=o&&n.setAttribute(t,o);return n},addClass(t,...e){const n=t instanceof Element?t:this.$(t);n?.classList.add(...e)},remClass(t,...e){const n=t instanceof Element?t:this.$(t);n?.classList.remove(...e)},addClassAll(t,...e){this.$$(t).forEach(t=>t.classList.add(...e))},remClassAll(t,...e){this.$$(t).forEach(t=>t.classList.remove(...e))},attr(t,e,n){const o=t instanceof Element?t:this.$(t);if(o)return void 0===n?o.getAttribute(e):void o.setAttribute(e,n)},css(t,e,n){const o=t instanceof Element?t:this.$(t);o&&("string"==typeof e&&void 0!==n?o.style[e]=n:"object"==typeof e&&Object.assign(o.style,e))},html(t,e){const n=t instanceof Element?t:this.$(t);if(n)return void 0===e?n.innerHTML:void(n.innerHTML=e)},text(t,e){const n=t instanceof Element?t:this.$(t);if(n)return void 0===e?n.textContent:void(n.textContent=e)},on(t,e,n,o){const i=t instanceof Element||t instanceof Document||t===window?t:this.$(t);i?.addEventListener(e,n,o)},off(t,e,n,o){const i=t instanceof Element||t instanceof Document||t===window?t:this.$(t);i?.removeEventListener(e,n,o)}},a={timeAt:0,timeTo:0,audioTrack:null,volumeGain:1,mixBuffers:!1,expandMono:!1,revsBuffer:!1,srcToTrack:!1,get source(){return this.audioTrack},set source(t){this.audioTrack!==t&&(this.audioTrack=t,this.audioTrack?(i.remClass('[data-button="paste"]',"grayed"),i.remClass("#pasteDialogFormGroup","grayed")):(i.addClass('[data-button="paste"]',"grayed"),i.addClass("#pasteDialogFormGroup","grayed")))}};e.exports={Attach:(t,e)=>{for(let n in e)t.appendChild(e[n])},AudioInstances:[],CreateAudioInstance:()=>({onplay:!1,stream:null,buffer:null,source:null,pixmap:null,timing:{current:0,elapsed:0,timeAt:0,timeTo:null},t:[],get slices(){return this.t},set slices(t){this.t!==t&&(this.t=t,this.o())},addSlice(t,e){this.t.push(t),this.o(e)},remSlice(t){this.t.length>0&&(this.t.pop(),this.o(t))},o(t){this.t.length>0?i.remClass(t,"grayed"):i.addClass(t,"grayed")},target:{parent:null,cursor:null,slices:null},button:null,bounds:null,canvas:null,clocks:null,cursor:null,detail:null,parent:null,ontime:null}),Elem:i,Slice:a,TouchDevice:()=>{let t=!1;var e;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t}}},{}],2:[function(t,e,n){"use strict";const{Elem:o,TouchDevice:i}=t("./a.js");class FFmpegHelper{ffmpegCore=null;ffmpegRunning=!1;ffmpegCurrentDuration=null;ffmpegLogContent=null;ffmpegLogEmptyCount=0;ffmpegDurationHandler=null;ffmpegProgressHandler=null;ffmpegLogHandler=null;handleFFmpegOutput=(t,e)=>{null!=this.ffmpegLogHandler&&this.ffmpegLogHandler(t,e),this.detectDuration(e),this.detectProgress(e),this.detectCompletion(e)};initialzeFFmpeg=async()=>{await createFFmpegCore({print:t=>{this.handleFFmpegOutput("stdout",t)},printErr:t=>{this.handleFFmpegOutput("stdout",t)}}).then(async t=>{this.ffmpegCore=t})};inSeconds=t=>3600*parseFloat(t[1])+60*parseFloat(t[2])+parseFloat(t[3])+1e3*parseFloat("0."+t[4])/1e3;detectProgress=t=>{var e=t.match(/.*time.(\d\d).(\d\d).(\d\d).(\d+).*/m);if(null!=e){var n=this.inSeconds(e),o=n;return null!=this.ffmpegCurrentDuration&&(o=~~(n/this.ffmpegCurrentDuration*100)),null!=this.ffmpegProgressHandler&&this.ffmpegProgressHandler(o),n}};FS=()=>this.ffmpegCore.FS;detectDuration=t=>{var e=t.match(/.*Duration..(\d\d).(\d\d).(\d\d).(\d+).*/m);if(null!=e){var n=this.inSeconds(e);return null!=this.ffmpegDurationHandler&&this.ffmpegDurationHandler(n),this.ffmpegCurrentDuration=n,n}};detectCompletion=t=>{(t.includes("kB muxing overhead")||t.includes("Invalid argument")||t.includes("Invalid data found")||t.includes("At least one output file"))&&null!==this.runResolve&&(this.runResolve(),this.runResolve=null,this.ffmpegLogEmptyCount=0,this.ffmpegRunning=!1,this.ffmpegCurrentDuration=null,null!=this.ffmpegProgressHandler&&this.ffmpegProgressHandler(100))};run=t=>{if(t=["-y","-hide_banner","-stats_period","0.2","-loglevel","info","-nostdin",...t],this.ffmpegRunning)throw Error("ffmpeg.wasm can only run one command at a time");return this.ffmpegRunning=!0,new Promise(e=>{this.runResolve=e,this.ffmpegCore.callMain(t)})}}const Elapsed=t=>{if(!t.source)return 0;const e=audioContext.currentTime,n=e-t.timing.current;return t.timing.current=e,t.timing.elapsed+=n*t.source.playbackRate.value,t.timing.elapsed},ToPixel=(t,e=null)=>{const n=t.parent.offsetWidth,o=(e?Elapsed(t):t.timing.timeAt)/t.buffer.duration;return Math.min(o*n,n).toFixed(1)+"px"},AudioTimeLine=(t,e)=>{if(e){const n=t.offsetWidth,i=Math.max(2,Math.floor(n/200)),formatTime=(t,e,n)=>{if(0===e)return"0";const o=Math.round(1e3*t),i=Math.floor(o/36e5),a=Math.floor(o%36e5/6e4),s=Math.floor(o%6e4/1e3),r=o%1e3;return i>0?e===n?`${i.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${i.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${r.toString().padStart(3,"0")}`:e===n?`${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${r.toString().padStart(3,"0")}`},a=Math.floor((e.length-1)/i);t.replaceChildren();for(let n=0;n<=i;n++){const s=n*a,r=Math.min(e[s],e[e.length-1]),l=o.cE("div",{"data-time":formatTime(r,n,i),style:`left:${s}px`});t.appendChild(l),n===i&&(l.style.left="100%")}}else t.replaceChildren()},AudioWave=(t,e)=>{if(!t.buffer)return;const n=[],o=e.height/2,i=e.getContext("2d"),a=t.buffer.getChannelData(0),s=a.length/t.buffer.sampleRate,r=Math.ceil(a.length/e.width);let l=0;for(let t=0;t<a.length;t++){const e=Math.abs(a[t]);e>l&&(l=e)}const u=l>0?1/l*.9:1;i.globalCompositeOperation="source-over",i.clearRect(0,0,e.width,e.height),i.fillStyle="#ffffff",i.fillRect(0,0,e.width,e.height),i.globalCompositeOperation="destination-out";for(let t=0;t<e.width;t++){let l=1,c=-1;for(let e=0;e<r;e++){const n=t*r+e;if(n>=a.length)break;const o=a[n];o<l&&(l=o),o>c&&(c=o)}const d=(1+l*u)*o,p=Math.max(1,(c-l)*u*o),f=t/e.width*s;n.push(f),i.fillRect(t,d,1,p)}return n.push(s),t.ontime&&AudioTimeLine(t.ontime,n),n};var a,s={getInstance:function(){return a||(a=function createInstance(){var t=new FFmpegHelper;return t.initialzeFFmpeg(),t}()),a}};e.exports={AudioBufferToPCM:t=>new Promise(e=>{const n=t.numberOfChannels,o=t.length,i=t.sampleRate,a=new Int16Array(o*n);let s=0;const processChunk=()=>{const r=Math.min(s+16384,o);for(;s<r;s++)for(let e=0;e<n;e++){let o=t.getChannelData(e)[s];o=Math.max(-1,Math.min(1,o)),a[s*n+e]=o<0?32768*o:32767*o}s<o?setTimeout(processChunk,0):e({audioData:new Uint8Array(a.buffer),sampleRate:i,numberOfChannels:n})};processChunk()}),AudioTimeLine:AudioTimeLine,AudioWave:AudioWave,CreateObserver:(t,e,n,i,a,s)=>new ResizeObserver(i=>{for(let r of i){const{width:i,height:l}=r.contentRect;if(n.width=i,t.pixmap=AudioWave(t,n),!t.onplay){const n=ToPixel(t),i=parseInt(n);e.style.setProperty("--position",n),a.style.left=n,i<.1?o.addClass(a,"hide"):o.remClass(a,"hide")}if(t.timing.timeTo){const e=t.timing.timeTo-t.timing.timeAt,n=t.buffer.duration,o=t.parent.offsetWidth,i=Math.min(t.timing.timeAt/n*o,o),a=Math.min(e/n*o,o);s.style.left=i.toFixed(1)+"px",s.style.width=a.toFixed(1)+"px"}}}),Elapsed:Elapsed,FFmpegSingleton:s,isSuppoted:t=>{if(!t)return!1;const e={mp3:"audio/mpeg",wav:"audio/wav",ogg:'audio/ogg; codecs="vorbis"',aac:'audio/mp4; codecs="mp4a.40.2"',m4a:'audio/mp4; codecs="mp4a.40.2"',flac:"audio/flac",opus:'audio/ogg; codecs="opus"'}[t.split(".").pop().toLowerCase()];if(!e)return!1;const n=document.createElement("audio").canPlayType(e);return"probably"===n||"maybe"===n},MemoryView:t=>{const calcBufferSize=t=>t instanceof Float32Array?4*t.length:t?.getChannelData?t.numberOfChannels*t.length*4:0;let e=0;for(let n in t)e+=calcBufferSize(t[n].buffer);i()?e>=209715200?o.addClass(memory,"warning"):o.remClass(memory,"warning"):e>=1610612736?o.addClass(memory,"warning"):o.remClass(memory,"warning"),o.text(memory,(t=>{if(t<1024)return t+"B";const e=t/1024;if(e<1024)return e.toFixed(2)+"KB";const n=e/1024;return n<1024?n.toFixed(2)+"MB":(n/1024).toFixed(2)+"GB"})(e))},PlaybackPosition:(t,e=null)=>{if(t.source)if(t.buffer.duration&&0!==t.buffer.duration){const n=ToPixel(t,e);t.parent.style.setProperty("--position",n),t.cursor.style.left=n}else t.parent.style.setProperty("--position",0),t.cursor.style.left=0},ToPixel:ToPixel,ToWidth:t=>{if(t.timing.timeTo){const e=t.parent.offsetWidth,n=(t.timing.timeTo-t.timing.timeAt)/t.buffer.duration;return Math.min(n*e,e).toFixed(1)+"px"}return 0},UpdateMouseTime:t=>{const e=Math.floor(t),n=Math.floor(t%1*1e3),o=Math.floor(e/3600),i=Math.floor(e%3600/60),a=e%60;return o.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0")+":"+a.toString().padStart(2,"0")+"."+n.toString().padStart(3,"0")}}},{"./a.js":1}],3:[function(t,e,n){"use strict";e.exports={ApplyGain:(t,e,n=!0)=>{const o=t.numberOfChannels;for(let i=0;i<o;i++){const o=t.getChannelData(i);for(let t=0;t<o.length;t++){let i=o[t]*e;n&&(i>1?i=1:i<-1&&(i=-1)),o[t]=i}}},BlendBuffers:async(t,e,n,o=!1)=>{e.sampleRate!==n.sampleRate&&(e=await(async(t,e,n)=>{if(e.sampleRate===n)return e;const o=new OfflineAudioContext(e.numberOfChannels,Math.round(e.duration*n),n),i=o.createBufferSource();return i.buffer=e,i.connect(o.destination),i.start(0),await o.startRendering()})(0,e,n.sampleRate));const i=e.numberOfChannels,a=n.numberOfChannels,s=Math.min(e.length,n.length);for(let t=0;t<a;t++){let r,l=n.getChannelData(t);r=o&&(1===i&&a>1||i>1&&1===a)?e.getChannelData(0):e.getChannelData(Math.min(t,i-1));for(let t=0;t<s;t++){let e=l[t]+r[t];e>1?e=1:e<-1&&(e=-1),l[t]=e}}return n},ChannelData:t=>{const e=[];for(let n=0;n<t.buffer.numberOfChannels;n++)e.push(t.buffer.getChannelData(n));return e},ConcatBuffer:async(t,...e)=>{const n=e.find(t=>null!==t);if(!n)return null;const o=n.sampleRate,i=n.numberOfChannels,a=[];for(const n of e){if(null===n)continue;let e=n;if(n.sampleRate!==o){const t=n.numberOfChannels,i=a.createBufferSource(),a=new OfflineAudioContext(t,Math.ceil(n.duration*o),o);i.buffer=n,i.connect(a.destination),i.start(0),e=await a.startRendering()}if(e.numberOfChannels!==i){const n=t.createBuffer(i,e.length,e.sampleRate);for(let t=0;t<i;t++){const o=n.getChannelData(t),i=e.getChannelData(Math.min(t,e.numberOfChannels-1));o.set(i)}e=n}a.push(e)}const s=a.reduce((t,e)=>t+e.length,0),r=t.createBuffer(i,s,o);for(let t=0;t<i;t++){const e=r.getChannelData(t);let n=0;for(const o of a)e.set(o.getChannelData(t),n),n+=o.length}return r},ReverseBuffer:t=>{const e=t.numberOfChannels;for(let n=0;n<e;n++){t.getChannelData(n).reverse()}},SliceBuffer:(t,e,n,o)=>{const i=e.sampleRate,a=e.numberOfChannels,s=n?Math.floor(n*i):0,r=o?Math.floor(o*i):e.length,l=Math.max(0,r-s);if(l<=0)return null;if(s===o)return null;const u=t.createBuffer(a,l,i);for(let t=0;t<a;t++){const n=e.getChannelData(t);u.getChannelData(t).set(n.subarray(s,r))}return u}}},{}],4:[function(t,e,n){"use strict";let o=-1;const{Attach:i,AudioInstances:a,CreateAudioInstance:s,Elem:r,Slice:l,TouchDevice:u}=t("./a.js"),{AudioBufferToPCM:c,AudioTimeLine:d,AudioWave:p,CreateObserver:f,Elapsed:m,FFmpegSingleton:h,isSuppoted:g,MemoryView:b,PlaybackPosition:w,ToPixel:x,ToWidth:v,UpdateMouseTime:y}=t("./b.js"),{ApplyGain:C,BlendBuffers:k,ChannelData:M,ConcatBuffer:B,ReverseBuffer:A,SliceBuffer:F}=t("./c.js"),T={compress:5,mimetype:"audio/flac",bitrate:128,quality:128},I="00.00.00.000",openAudio=(t,e,n,o,a)=>{const s={elem:null,down:null,move:null,size:null,mode:null,posl:0,posw:0,offs:0},l=r.cE("div",{class:"button center middle gap-sm"}),u=r.cE("div",{class:"ontime center middle"}),c=r.cE("div",{class:"cursor center middle hide"}),d=r.cE("div",{class:"slicer center middle hide"}),m=r.cE("div",{class:"bounds center middle"}),h=r.cE("div",{class:"parent center middle"}),g=r.cE("a",{class:"icon-button grayed","data-index":a,"data-button":"undoBtn",href:"#",title:"Undo last operation"}),b=r.cE("a",{class:"icon-button","data-index":a,"data-button":"cropBtn",href:"#",title:"Crop selection"}),w=r.cE("a",{class:"icon-button","data-index":a,"data-button":"dropBtn",href:"#",title:"Drop selection"}),x=r.cE("a",{class:"icon-button","data-index":a,"data-button":"copyBtn",href:"#",title:"Copy/paste"}),v=r.cE("a",{class:"icon-button","data-index":a,"data-button":"playBtn",href:"#",title:"Play/Stop audio"}),C=r.cE("a",{class:"icon-button","data-index":a,"data-button":"saveBtn",href:"#",title:"Save to wav/mp3/ogg"});if(o.buffer){const t=r.cE("div",{class:"header center middle"}),a=r.cE("div",{class:"label middle","data-text":n}),k=r.cE("div",{class:"clock center middle gap-sm","data-timeat":I,"data-timeto":I});i(t,[a,k]),i(e,[t,u,h,l]),e.classList.contains("hide")&&r.remClass(e,"hide");const M=r.cE("canvas",{width:h.offsetWidth+"px",height:h.offsetHeight+"px"});o.button=g,o.ontime=u,o.bounds=m,o.canvas=M,o.parent=h,o.cursor=c,o.detail=n,o.clocks=k,o.pixmap=p(o,M),i(h,[M,c,d,m]),i(l,[v,g,b,w,x,C]),r.on(window,"pointerdown",t=>{if(!o.onplay)if(t.target===M)o.timing.timeTo=null,k.dataset.timeto=I,s.elem=M,s.down=t.clientX,m.style.left=0,m.style.width=0,r.addClass(m,"pointer"),r.addClass(d,"hide"),d.style.left=0;else if(t.target===m){const e=5,n=m.getBoundingClientRect();s.elem=m,s.down=t.clientX,s.offs=t.clientX-n.left,s.offs<e?(s.mode="left",s.posl=parseFloat(m.style.left),s.posw=m.offsetWidth):s.offs>n.width-e?(s.mode="right",s.posl=parseFloat(m.style.left),s.posw=m.offsetWidth):(s.mode=null,s.pixl=0,s.pixw=0)}},{passive:!1}),r.on(window,"pointerup",t=>{if(!o.onplay){if(s.elem===M){if(!o.timing.timeTo){const e=M.getBoundingClientRect(),n=t.clientX-e.left|0;o.timing.timeAt=Number(o.pixmap[n]),h.style.setProperty("--position",n+"px"),r.remClass(c,"hide"),c.style.left=n+"px"}r.remClass(c,"hide")}s.elem=null,s.down=null,s.mode=null,s.offs=0,r.remClass(m,"pointer")}},{passive:!1}),r.on(window,"pointermove",t=>{if(t.preventDefault(),!o.onplay)if(s.down){const e=M.getBoundingClientRect();if(s.mode){let n=t.clientX-e.left|0,i=0,a=0;if(n<0||n>e.width)return;"left"===s.mode?(i=n,a=s.posl+s.posw-n,a<0&&(i=s.posl+s.posw,a=Math.abs(a))):"right"===s.mode&&(i=s.posl,a=s.posw+(n-(s.posl+s.posw)),a<0&&(i=s.posl+a,a=Math.abs(a))),o.timing.timeAt=Number(o.pixmap[i]),o.timing.timeTo=Number(o.pixmap[i+a]),k.dataset.timeat=y(o.timing.timeAt),k.dataset.timeto=y(o.timing.timeTo),m.style.left=i+"px",c.style.left=i+"px",m.style.width=a+"px",h.style.setProperty("--position",i+"px")}else if(s.elem===M){const n=s.down-e.left|0,i=t.clientX-e.left|0;if(i<0||i>e.width)return;const a=Math.min(n,i),r=Math.max(n,i);Math.abs(a-r)>1&&(o.timing.timeAt=Number(o.pixmap[a]),o.timing.timeTo=Number(o.pixmap[r]),k.dataset.timeat=y(o.timing.timeAt),k.dataset.timeto=y(o.timing.timeTo),m.style.left=a+"px",c.style.left=a+"px",m.style.width=r-a+"px",h.style.setProperty("--position",a+"px"))}else if(s.elem===m){const n=t.clientX-e.left-s.offs|0,i=Math.max(0,Math.min(n,M.width-m.offsetWidth)),a=i+m.offsetWidth;o.timing.timeAt=Number(o.pixmap[i]),o.timing.timeTo=Number(o.pixmap[a]),k.dataset.timeat=y(o.timing.timeAt),k.dataset.timeto=y(o.timing.timeTo),m.style.left=i+"px",c.style.left=i+"px",h.style.setProperty("--position",i+"px")}}else if(t.target===M){const e=M.getBoundingClientRect(),n=t.clientX-e.left|0,i=Number(o.pixmap[n]);k.dataset.timeat=y(i),r.remClass(d,"hide"),d.style.left=n+"px"}else if(t.target===m){const e=5,n=m.getBoundingClientRect(),o=t.clientX-n.left;o<e||o>n.width-e?m.style.cursor="ew-resize":m.style.cursor="pointer"}},{passive:!1}),r.on(M,"pointerout",t=>{r.addClass(d,"hide"),r.remClass(m,"pointer"),k.dataset.timeat=y(o.timing.timeAt)},{passive:!1});f(o,h,M,u,c,m).observe(h)}r.remClass(t,"disabled")};r.$$("input").forEach(t=>{r.on(t,"input",t=>{const e=t.target.value;switch(t.target.id){case"flac":"on"===e&&(T.mimetype="audio/flac");break;case"mp3":"on"===e&&(T.mimetype="audio/mpeg");break;case"ogg":"on"===e&&(T.mimetype="audio/ogg");break;case"compress":T.compress=parseFloat(e),t.target.nextElementSibling.textContent="compress: "+e;break;case"quality":T.quality=parseFloat(e),t.target.nextElementSibling.textContent="bitrate: "+e+"kbps";break;case"bitrate":T.bitrate=parseFloat(e),t.target.nextElementSibling.textContent="bitrate: "+e+"kbps";break;case"volume":l.volumeGain=parseFloat(e)/100,t.target.nextElementSibling.textContent="Source volume: "+e+"%";break;case"mixBuffers":case"expandMono":case"revsBuffer":case"srcToTrack":l[t.target.id]=t.target.checked}})}),r.on(document,"click",async t=>{if(t.target.hasAttribute("data-button")){t.preventDefault();const e=t.target,n=r.$("#editor"),i=r.$("#memory"),u=e.dataset.button,dialog=t=>{r.$$(".dialog").forEach(e=>{e.id===t?r.addClass(e,"visible"):r.remClass(e,"visible")})},reinit=(t,e,n)=>{t.timing.timeAt=e,t.timing.timeTo=n,t.clocks.dataset.timeat=y(e),t.clocks.dataset.timeto=y(n);const o=x(t),s=v(t);e?(t.cursor.style.left=o,r.remClass(t.cursor,"hide")):(t.cursor.style.left=0,r.addClass(t.cursor,"hide")),n?(t.bounds.style.left=o,t.bounds.style.width=s):(t.bounds.style.left=0,t.bounds.style.width=0),b(a,i),t.parent.style.setProperty("--position",o),t.pixmap=p(t,t.canvas)};if("addAudio"===u){const t=r.cE("input",{type:"file"});r.on(t,"input",async t=>{const o=t.target.files[0];if(audioContext&&o)if(r.addClass(e,"disabled"),g(o.name)){a.push(s());const t=a.length-1;a[t].buffer=await audioContext.decodeAudioData(await o.arrayBuffer()),openAudio(e,n,o.name,a[t],t),b(a,i)}else try{const t=await o.arrayBuffer(),r=h.getInstance();await r.initialzeFFmpeg();const l=["-i",o.name,"-vn","-codec:a","pcm_s16le","-f","wav","output.wav"];r.FS().writeFile(o.name,new Uint8Array(t)),await r.run(l);const u=r.FS().readFile("output.wav");a.push(s());const c=a.length-1;a[c].buffer=await audioContext.decodeAudioData(u.buffer.slice(u.byteOffset,u.byteOffset+u.byteLength)),openAudio(e,n,o.name,a[c],c),b(a,i)}catch(t){return void r.remClass(e,"disabled")}}),t.click()}else if("playBtn"===u){if(!e.hasAttribute("data-index"))return;const n=parseInt(e.dataset.index),o=a[n],playBuffer=()=>{const e=o.timing.timeAt,n=o.timing.timeTo?o.timing.timeTo-e:o.buffer.duration;o.timing.elapsed=e,o.timing.current=audioContext.currentTime,o.source=audioContext.createBufferSource(),o.source.buffer=o.buffer,o.source.connect(audioContext.destination),o.source.start(0,e,n),o.source.onended=async()=>{o.onplay=!1,o.source=null;const i=Math.abs(o.timing.elapsed-n)<.1||Math.abs(o.timing.elapsed-(e+n))<.1;if(o.parent)if(i){if(o.timing.timeTo){const t=y(o.timing.timeAt);o.clocks.dataset.timeat=t}else o.timing.timeAt=0,o.clocks.dataset.timeat=I;const t=x(o),e=parseInt(t);o.parent.style.setProperty("--position",t),o.cursor.style.left=t,e<.1?r.addClass(o.cursor,"hide"):r.remClass(o.cursor,"hide")}else if(o.timing.timeTo){const t=x(o),e=parseInt(t);o.parent.style.setProperty("--position",t),o.cursor.style.left=t,e<.1?r.addClass(o.cursor,"hide"):r.remClass(o.cursor,"hide")}t.target.dataset.button="playBtn"};const updateVisual=()=>{if(o.source&&o.onplay){const t=m(o),e=y(t);w(o,o.timing.timeTo),o.timing.timeTo||(o.timing.timeAt=t),o.clocks.dataset.timeat=e,requestAnimationFrame(updateVisual)}};t.target.dataset.button="stopBtn",o.onplay=!0,r.remClass(o.cursor,"hide"),updateVisual()};o.source?(o.timing.elapsed=0,o.timing.current=audioContext.currentTime,playBuffer()):o.buffer&&(o.timing.elapsed=0,o.timing.current=audioContext.currentTime,o.source=audioContext.createBufferSource(),o.source.buffer=o.buffer,playBuffer())}else if("stopBtn"===u){if(!e.hasAttribute("data-index"))return;const t=parseInt(e.dataset.index),n=a[t];if(n.onplay)return n.source.stop(),void(n.source=null)}else if("undoBtn"===u){if(!e.hasAttribute("data-index"))return;const t=a[parseInt(e.dataset.index)];if(t.onplay)return;const n=t.slices[t.slices.length-1],Init=t=>{t.remSlice(t.button),t.pixmap=p(t,t.canvas),t.timing.timeAt=n.timeAt,t.timing.timeTo=n.timeTo,t.timing.elapsed=n.timeAt,t.clocks.dataset.timeat=y(n.timeAt),t.clocks.dataset.timeto=y(n.timeTo),t.cursor.style.left=n.cursor,t.bounds.style.left=n.xBound,t.bounds.style.width=n.wBound,t.parent.style.setProperty("--position",n.cursor),parseFloat(n.cursor)>0?r.remClass(t.cursor,"hide"):r.addClass(t.cursor,"hide"),b(a,i)};"crop"===n.create?(t.buffer=await B(audioContext,n.subset.bufferAt,t.buffer,n.subset.bufferTo),Init(t)):"drop"===n.create?(t.buffer=await B(audioContext,F(audioContext,t.buffer,null,n.timeAt),n.subset,F(audioContext,t.buffer,n.timeAt,null)),Init(t)):"paste"===n.create&&("insert"===n.subset.process?(t.buffer=await B(audioContext,F(audioContext,t.buffer,null,n.timeAt),F(audioContext,t.buffer,n.subset.sliceTo,null)),Init(t)):"replace"!==n.subset.process&&"blending"!==n.subset.process||(t.buffer=await B(audioContext,F(audioContext,t.buffer,null,n.timeAt),n.subset.replace,F(audioContext,t.buffer,n.subset.sliceTo,null)),Init(t)))}else if("cropBtn"===u){if(!e.hasAttribute("data-index"))return;const t=a[parseInt(e.dataset.index)];if(t.onplay)return;if(t.timing.timeTo){if(t.timing.timeTo-t.timing.timeAt<.01)return;if(t.timing.timeTo-t.timing.timeAt===t.buffer.duration)return;t.addSlice({create:"crop",timeAt:t.timing.timeAt,timeTo:t.timing.timeTo,subset:{bufferAt:F(audioContext,t.buffer,null,t.timing.timeAt),bufferTo:F(audioContext,t.buffer,t.timing.timeTo,null)},cursor:t.cursor.style.left,xBound:t.bounds.style.left,wBound:t.bounds.style.width},t.button),t.buffer=F(audioContext,t.buffer,t.timing.timeAt,t.timing.timeTo),reinit(t,0,null)}}else if("dropBtn"===u){if(!e.hasAttribute("data-index"))return;const t=a[parseInt(e.dataset.index)];if(t.onplay)return;if(t.timing.timeTo){if(t.timing.timeTo-t.timing.timeAt<.01)return;if(t.timing.timeTo-t.timing.timeAt===t.buffer.duration)return;t.addSlice({create:"drop",timeAt:t.timing.timeAt,timeTo:t.timing.timeTo,subset:F(audioContext,t.buffer,t.timing.timeAt,t.timing.timeTo),cursor:t.cursor.style.left,xBound:t.bounds.style.left,wBound:t.bounds.style.width},t.button),t.buffer=await B(audioContext,F(audioContext,t.buffer,null,t.timing.timeAt),F(audioContext,t.buffer,t.timing.timeTo,null)),reinit(t,0,null)}}else if("copyBtn"===u){if(!e.hasAttribute("data-index"))return;o=parseInt(e.dataset.index),dialog("copyDialog")}else if("copy"===u){if(o<0)return;const t=a[o];if(t.timing.timeTo){if(t.timing.timeTo-t.timing.timeAt<.01)return;l.timeAt=t.timing.timeAt,l.timeTo=t.timing.timeTo,l.source=t}}else if("paste"===u){if(o<0)return;const t=a[o],r=t.timing.timeAt+(t.timing.timeTo-t.timing.timeAt),u=t.timing.timeAt+(l.timeTo-l.timeAt);if(t.onplay)return;if(t.timing.timeTo)if(l.srcToTrack){a.push(s());const t=a.length-1;a[t].buffer=F(audioContext,l.source.buffer,l.timeAt,l.timeTo),l.revsBuffer&&A(a[t].buffer),1!==l.volumeGain&&C(a[t].buffer,l.volumeGain),openAudio(e,n,"Audio fragment #"+Date.now(),a[t],t),b(a,i),l.timeAt=0,l.timeTo=0,l.source=null}else{const e=l.mixBuffers?"blending":"replace",n=l.mixBuffers?r:u;t.addSlice({create:"paste",timeAt:t.timing.timeAt,timeTo:t.timing.timeTo,subset:{process:e,replace:F(audioContext,t.buffer,t.timing.timeAt,t.timing.timeTo),sliceTo:n},cursor:t.cursor.style.left,xBound:t.bounds.style.left,wBound:t.bounds.style.width},t.button);let o=null;if(l.mixBuffers){let e=F(audioContext,l.source.buffer,l.timeAt,l.timeTo);l.revsBuffer&&A(e),1!==l.volumeGain&&C(e,l.volumeGain),o=await k(audioContext,e,F(audioContext,t.buffer,t.timing.timeAt,t.timing.timeTo),l.expandMono),e=null}else o=F(audioContext,l.source.buffer,l.timeAt,l.timeTo),l.revsBuffer&&A(o),1!==l.volumeGain&&C(o,l.volumeGain);t.buffer=await B(audioContext,F(audioContext,t.buffer,null,t.timing.timeAt),o,F(audioContext,t.buffer,t.timing.timeTo,null)),reinit(t,t.timing.timeAt,n),l.timeAt=0,l.timeTo=0,l.source=null,o=null}else{t.addSlice({create:"paste",timeAt:t.timing.timeAt,timeTo:t.timing.timeTo,subset:{process:"insert",replace:null,sliceTo:u},cursor:t.cursor.style.left,xBound:t.bounds.style.left,wBound:t.bounds.style.width},t.button);let e=F(audioContext,l.source.buffer,l.timeAt,l.timeTo);l.revsBuffer&&A(e),1!==l.volumeGain&&C(e,l.volumeGain),t.buffer=await B(audioContext,F(audioContext,t.buffer,null,t.timing.timeAt),e,F(audioContext,t.buffer,t.timing.timeAt,null)),reinit(t,t.timing.timeAt,null),l.timeAt=0,l.timeTo=0,l.source=null,e=null}}else if("saveBtn"===u){if(!e.hasAttribute("data-index"))return;o=parseInt(e.dataset.index),dialog("saveDialog")}else if("save"===u){if(o<0)return;r.addClass(e,"grayed");const fname=(t,e)=>{const n=t.lastIndexOf(".");return n<=0?t+e:t.slice(0,n)+e},toB64=(t,e)=>{const n=new FileReader;n.onloadend=()=>e(n.result),n.readAsDataURL(t)},t=a[o].detail,n=await c(a[o].buffer),i=h.getInstance();let s,l;switch(await i.initialzeFFmpeg(),i.ffmpegProgressHandler=t=>e.dataset.process=`Prepare: ${t}%`,i.FS().writeFile("input.pcm",n.audioData),T.mimetype){case"audio/flac":const e=Number.isFinite(T.compress)?T.compress:5;l=fname(t,".flac"),s=["-f","s16le","-ar",n.sampleRate.toString(),"-ac",n.numberOfChannels.toString(),"-i","input.pcm","-vn","-c:a","flac","-compression_level",e.toString(),l];break;case"audio/mpeg":const o=Number.isFinite(T.bitrate)?T.bitrate:128;l=fname(t,".mp3"),s=["-f","s16le","-ar",n.sampleRate.toString(),"-ac",n.numberOfChannels.toString(),"-i","input.pcm","-vn","-c:a","libmp3lame","-b:a",o.toString()+"k",l];break;case"audio/ogg":const i=Number.isFinite(T.quality)?T.quality:128;l=fname(t,".ogg"),s=["-f","s16le","-ar",n.sampleRate.toString(),"-ac",n.numberOfChannels.toString(),"-i","input.pcm","-vn","-c:a","libopus","-b:a",i.toString()+"k","-vbr","on",l]}try{await i.run(s)}catch(t){return void r.remClass(e,"grayed")}const u=i.FS().readFile(l);toB64(new Blob([u.buffer],{type:T.mimetype}),t=>{const e=r.cE("a",{download:l,href:t});document.body.appendChild(e),e.click(),document.body.removeChild(e)}),r.remClass(e,"grayed"),e.dataset.process="Prepare: 0%"}else if("closeBtn"===u){const t=e.parentNode;o=-1,r.remClass(t,"visible")}}})},{"./a.js":1,"./b.js":2,"./c.js":3,"./d.js":4}]});