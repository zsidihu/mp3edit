const audioContext=new(window.AudioContext||window.webkitAudioContext);!function(e){!function require(t){var a={exports:{}};return e[t][0].call(a.exports,function(a){return require(e[t][1][a])},a,a.exports),a.exports}(2)}({1:[function(e,t,a){"use strict";const n=["rect","circle","ellipse","line","polyline","polygon","path","text","tspan","textPath","svg","g","defs","use","symbol","style","clipPath","mask","filter","pattern","linearGradient","radialGradient","title","desc","image"],o={$:document.querySelector.bind(document),$$:document.querySelectorAll.bind(document),cE(e,t={}){const a=n.includes(e)?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);for(const[e,n]of Object.entries(t))null!=n&&a.setAttribute(e,n);return a},addClass(e,...t){const a=e instanceof Element?e:this.$(e);a?.classList.add(...t)},remClass(e,...t){const a=e instanceof Element?e:this.$(e);a?.classList.remove(...t)},addClassAll(e,...t){this.$$(e).forEach(e=>e.classList.add(...t))},remClassAll(e,...t){this.$$(e).forEach(e=>e.classList.remove(...t))},attr(e,t,a){const n=e instanceof Element?e:this.$(e);if(n)return void 0===a?n.getAttribute(t):void n.setAttribute(t,a)},css(e,t,a){const n=e instanceof Element?e:this.$(e);n&&("string"==typeof t&&void 0!==a?n.style[t]=a:"object"==typeof t&&Object.assign(n.style,t))},html(e,t){const a=e instanceof Element?e:this.$(e);if(a)return void 0===t?a.innerHTML:void(a.innerHTML=t)},text(e,t){const a=e instanceof Element?e:this.$(e);if(a)return void 0===t?a.textContent:void(a.textContent=t)},on(e,t,a,n){const o=e instanceof Element||e instanceof Document||e===window?e:this.$(e);o?.addEventListener(t,a,n)},off(e,t,a,n){const o=e instanceof Element||e instanceof Document||e===window?e:this.$(e);o?.removeEventListener(t,a,n)}};class FFmpegHelper{ffmpegCore=null;ffmpegRunning=!1;ffmpegCurrentDuration=null;ffmpegLogContent=null;ffmpegLogEmptyCount=0;ffmpegDurationHandler=null;ffmpegProgressHandler=null;ffmpegLogHandler=null;handleFFmpegOutput=(e,t)=>{null!=this.ffmpegLogHandler&&this.ffmpegLogHandler(e,t),this.detectDuration(t),this.detectProgress(t),this.detectCompletion(t)};initialzeFFmpeg=async()=>{await createFFmpegCore({print:e=>{this.handleFFmpegOutput("stdout",e)},printErr:e=>{this.handleFFmpegOutput("stdout",e)}}).then(async e=>{this.ffmpegCore=e})};inSeconds=e=>3600*parseFloat(e[1])+60*parseFloat(e[2])+parseFloat(e[3])+1e3*parseFloat("0."+e[4])/1e3;detectProgress=e=>{var t=e.match(/.*time.(\d\d).(\d\d).(\d\d).(\d+).*/m);if(null!=t){var a=this.inSeconds(t),n=a;return null!=this.ffmpegCurrentDuration&&(n=~~(a/this.ffmpegCurrentDuration*100)),null!=this.ffmpegProgressHandler&&this.ffmpegProgressHandler(n),a}};FS=()=>this.ffmpegCore.FS;detectDuration=e=>{var t=e.match(/.*Duration..(\d\d).(\d\d).(\d\d).(\d+).*/m);if(null!=t){var a=this.inSeconds(t);return null!=this.ffmpegDurationHandler&&this.ffmpegDurationHandler(a),this.ffmpegCurrentDuration=a,a}};detectCompletion=e=>{(e.includes("kB muxing overhead")||e.includes("Invalid argument")||e.includes("Invalid data found")||e.includes("At least one output file"))&&null!==this.runResolve&&(this.runResolve(),this.runResolve=null,this.ffmpegLogEmptyCount=0,this.ffmpegRunning=!1,this.ffmpegCurrentDuration=null,null!=this.ffmpegProgressHandler&&this.ffmpegProgressHandler(100))};run=e=>{if(e=["-y","-hide_banner","-stats_period","0.2","-loglevel","info","-nostdin",...e],this.ffmpegRunning)throw Error("ffmpeg.wasm can only run one command at a time");return this.ffmpegRunning=!0,new Promise(t=>{this.runResolve=t,this.ffmpegCore.callMain(e)})}}var i,s={getInstance:function(){return i||(i=function createInstance(){var e=new FFmpegHelper;return e.initialzeFFmpeg(),e}()),i}};t.exports={AudioBufferToPCM:e=>new Promise(t=>{const a=e.numberOfChannels,n=e.length,o=e.sampleRate,i=new Int16Array(n*a);let s=0;const processChunk=()=>{const r=Math.min(s+16384,n);for(;s<r;s++)for(let t=0;t<a;t++){let n=e.getChannelData(t)[s];n=Math.max(-1,Math.min(1,n)),i[s*a+t]=n<0?32768*n:32767*n}s<n?setTimeout(processChunk,0):t({audioData:new Uint8Array(i.buffer),sampleRate:o,numberOfChannels:a})};processChunk()}),Attach:(e,t)=>{for(let a in t)e.appendChild(t[a])},Elapsed:(e,t)=>{if(!e.source[t])return 0;const a=audioContext.currentTime,n=a-e.timing[t].current;return e.timing[t].current=a,e.timing[t].elapsed+=n*e.source[t].playbackRate.value,e.timing[t].elapsed},Elem:o,FFmpegSingleton:s,FormatTime:e=>{const t=Math.floor(e),a=Math.floor(e%1*1e3),n=Math.floor(t/3600),o=Math.floor(t%3600/60),i=t%60;return n.toString().padStart(2,"0")+":"+o.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0")+"."+a.toString().padStart(3,"0")},isSuppoted:e=>{if(!e)return!1;const t={mp3:"audio/mpeg",wav:"audio/wav",ogg:'audio/ogg; codecs="vorbis"',aac:'audio/mp4; codecs="mp4a.40.2"',m4a:'audio/mp4; codecs="mp4a.40.2"',flac:"audio/flac",opus:'audio/ogg; codecs="opus"'}[e.split(".").pop().toLowerCase()];if(!t)return!1;const a=document.createElement("audio").canPlayType(t);return"probably"===a||"maybe"===a},TouchDevice:()=>{let e=!1;var t;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e},UniqueID:(e=8)=>{const t=new Uint8Array(e);return crypto.getRandomValues(t),"id_"+Array.from(t).map(e=>e.toString(36).padStart(2,"0")).join("").substring(0,e)}}},{}],2:[function(e,t,a){"use strict";let n=0;const o={onplay:[!1,!1],ontime:[null,null],buffer:[null,null],source:[null,null],detail:[null,null],master:0,timing:[{current:0,elapsed:0},{current:0,elapsed:0}]},i={compress:5,mimetype:"audio/flac",bitrate:128,quality:128},{AudioBufferToPCM:s,Attach:r,Elapsed:c,Elem:l,FFmpegSingleton:d,FormatTime:u,isSuppoted:p,TouchDevice:m,UniqueID:f}=e("./a.js"),DisableGroup=e=>{l.$$(".icon-button").forEach(t=>e?l.addClass(t,"grayed"):l.remClass(t,"grayed"))};l.$$("input").forEach(e=>{l.on(e,"input",e=>{const t=e.target.value;switch(e.target.id){case"flac":"on"===t&&(i.mimetype="audio/flac");break;case"mp3":"on"===t&&(i.mimetype="audio/mpeg");break;case"ogg":"on"===t&&(i.mimetype="audio/ogg");break;case"compress":i.compress=parseFloat(t),e.target.nextElementSibling.textContent="compress: "+t;break;case"quality":i.quality=parseFloat(t),e.target.nextElementSibling.textContent="bitrate: "+t+"kbps";break;case"bitrate":i.bitrate=parseFloat(t),e.target.nextElementSibling.textContent="bitrate: "+t+"kbps"}})}),l.on(document,"click",async e=>{if(e.target.hasAttribute("data-button")){const t=e.target,a=t.dataset.button,r=parseFloat(t.dataset?.index||0),dialog=e=>{l.$$(".dialog").forEach(t=>{t.id===e?l.addClass(t,"visible"):l.remClass(t,"visible")})};if("A"===t.tagName&&e.preventDefault(),"uploadBtn"===a){const e=l.cE("input",{accept:"audio/*",type:"file"});l.on(e,"input",async e=>{const a=e.target.files[0];if(audioContext&&a){if(l.addClass(t.parentNode,"disabled"),p(a.name))o.detail[r]=a.name,o.ontime[r]=t.parentNode.children[1],o.buffer[r]=await audioContext.decodeAudioData(await a.arrayBuffer());else try{const e=await a.arrayBuffer(),n=d.getInstance();await n.initialzeFFmpeg();const i=["-i",a.name,"-vn","-codec:a","pcm_s16le","-f","wav","output.wav"];n.FS().writeFile(a.name,new Uint8Array(e)),await n.run(i);const s=n.FS().readFile("output.wav");o.detail[r]=a.name,o.ontime[r]=t.parentNode.children[1],o.buffer[r]=await audioContext.decodeAudioData(s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength))}catch(e){return void l.remClass(t.parentNode,"disabled")}l.text(o.ontime[r],u(o.buffer[r].duration)),t.parentNode.dataset.label=a.name,l.remClass(t.parentNode,"disabled"),l.remClass(t.parentNode.firstElementChild,"grayed"),l.remClass(t.parentNode.lastElementChild,"grayed")}}),e.click()}else if("setRadio"===a)l.$$("div.radio").forEach(e=>{e===t?l.addClass(e,"checked"):l.remClass(e,"checked")}),o.master=r;else if("playBtn"===a){o.timing[r].elapsed=0,o.timing[r].current=audioContext.currentTime,o.source[r]=audioContext.createBufferSource(),o.source[r].buffer=o.buffer[r],o.source[r].connect(audioContext.destination),o.source[r].start(0),o.source[r].onended=()=>{const e=u(o.buffer[r].duration);o.source[r]=null,o.onplay[r]=!1,t.dataset.button="playBtn",l.text(o.ontime[r],e)};const UpdateTime=()=>{if(o.source[r]&&o.onplay[r]){if(!o.onplay[r])return;const e=c(o,r),t=u(e);e>=o.buffer[r].duration&&o.source[r].stop(),l.text(o.ontime[r],t),requestAnimationFrame(UpdateTime)}};o.onplay[r]=!0,t.dataset.button="stopBtn",UpdateTime()}else if("stopBtn"===a)o.source[r]&&o.source[r].stop();else if("syncAudio"===a){if(o.buffer[0]&&o.buffer[1]){const e=o.master,a=1-o.master,n=o.buffer[a].duration/o.buffer[e].duration;DisableGroup(!0),l.addClass(t,"disabled");const i=o.buffer[e].numberOfChannels,s=o.buffer[e].sampleRate,r=[],c=[];for(let t=0;t<i;t++){const a=o.buffer[e].getChannelData(t),n=new Float32Array(a.length);n.set(a),r.push(n),c.push(n.buffer)}const d={type:"process",channels:r.length,sampleRate:s,length:r[0].length,factor:n,channelBuffers:r},p=new URL("../assets/script/process.js",import.meta.url).href,m=new Worker(URL.createObjectURL(new Blob([`self.onmessage=async a=>{const b=a.data;if("process"===b.type)try{const a=await import("${p}"),c=a.default||a,d=await c(),e=b.channels,f=b.sampleRate,g=b.length,h=b.factor||1,i=1/h;d._presetDefault(e,f),d._reset();const j=d._blockSamples(),k=d._intervalSamples(),l=d._inputLatency(),m=d._outputLatency(),n=l+m,o=d._setBuffers(e,n),p=4,q=d.HEAPF32,r=[],s=[];for(let a=0;a<e;a++)r.push(o/p+n*a),s.push(o/p+n*(a+e));const t=a=>new Float32Array(q.buffer,r[a]*p,n),u=a=>new Float32Array(q.buffer,s[a]*p,n),v=b.channelBuffers,w=Math.max(1,Math.round(g*h)),x=new Float32Array(w*e),y=m+2*k;for(let a=0;a<e;a++){const b=t(a);b.fill(0);const c=v[a],d=Math.min(c.length,n-y);b.set(c.subarray(0,d),y);for(let a=0;a<y;a++)b[a]*=a/y}d._seek(n,i);let z=n,A=0;const B=v[0],C=Math.ceil(w/Math.max(1,Math.round(k/Math.max(1e-9,i))))+20;for(let a=0;A<w&&a<C;++a){for(let a=0;a<e;++a){const b=t(a);b.copyWithin(0,k);const c=v[a],d=Math.max(0,c.length-z),e=Math.min(k,d);0<e?(b.set(c.subarray(z,z+e),n-k),e<k&&b.fill(0,n-k+e,n)):b.fill(0,n-k,n)}z+=k;const b=Math.max(0,Math.round(k/Math.max(1e-9,i)));if(!(0>=b)){d._process(k,b);for(let a=0;a<e;++a){const c=u(a);let d=A*e+a;for(let a=0;a<b&&A+a<w;++a)x[d+a*e]=c[a]}if(A+=b,0==(7&a)){const a=Math.min(100,Math.round(100*(A/w)))+"%";postMessage({progress:a})}}}const D=Math.max(m,512);d._flush(D);const E=Math.min(D,Math.max(0,w-A));if(0<E){for(let a=0;a<e;++a){const b=u(a);let c=A*e+a;for(let a=0;a<E&&A+a<w;++a)x[c+a*e]=b[a]}A+=E}postMessage({result:{buffer:x.buffer,sampleRate:f,channels:e,length:w}},[x.buffer])}catch(a){postMessage({error:a.message||a+""})}};`],{type:"application/javascript"})),{type:"module"});m.onmessage=a=>{const n=a.data;if("progress"in n)t.dataset.process="Process "+n.progress;else if("result"in n){const a=n.result,i=new Float32Array(a.buffer);o.buffer[e]=audioContext.createBuffer(a.channels,a.length,a.sampleRate);for(let t=0;t<a.channels;t++){const n=o.buffer[e].getChannelData(t);for(let e=0;e<a.length;e++)n[e]=i[e*a.channels+t]||0}l.text(o.ontime[e],u(o.buffer[e].duration)),DisableGroup(!1),l.remClass(t,"disabled"),m.terminate()}else"error"in n&&(console.log(n.error),DisableGroup(!1),l.remClass(t,"disabled"),m.terminate())},m.postMessage(d,c)}}else if("saveBtn"===a)n=r,dialog("saveDialog");else if("save"===a){l.addClass(t,"grayed");const fname=(e,t)=>{const a=e.lastIndexOf(".");return a<=0?e+t:e.slice(0,a)+t},toB64=(e,t)=>{const a=new FileReader;a.onloadend=()=>t(a.result),a.readAsDataURL(e)},e=o.detail[n],a=await s(o.buffer[n]),r=d.getInstance();let c,u;switch(await r.initialzeFFmpeg(),r.ffmpegProgressHandler=e=>t.dataset.process=`Prepare: ${e}%`,r.FS().writeFile("input.pcm",a.audioData),i.mimetype){case"audio/flac":const t=Number.isFinite(i.compress)?i.compress:5;u=fname(e,".flac"),c=["-f","s16le","-ar",a.sampleRate.toString(),"-ac",a.numberOfChannels.toString(),"-i","input.pcm","-vn","-c:a","flac","-compression_level",t.toString(),u];break;case"audio/mpeg":const n=Number.isFinite(i.bitrate)?i.bitrate:128;u=fname(e,".mp3"),c=["-f","s16le","-ar",a.sampleRate.toString(),"-ac",a.numberOfChannels.toString(),"-i","input.pcm","-vn","-c:a","libmp3lame","-b:a",n.toString()+"k",u];break;case"audio/ogg":const o=Number.isFinite(i.quality)?i.quality:128;u=fname(e,".ogg"),c=["-f","s16le","-ar",a.sampleRate.toString(),"-ac",a.numberOfChannels.toString(),"-i","input.pcm","-vn","-c:a","libopus","-b:a",o.toString()+"k","-vbr","on",u]}try{await r.run(c)}catch(e){return void l.remClass(t,"grayed")}const p=r.FS().readFile(u);toB64(new Blob([p.buffer],{type:i.mimetype}),e=>{const t=l.cE("a",{download:u,href:e});document.body.appendChild(t),t.click(),document.body.removeChild(t)}),l.remClass(t,"grayed"),t.dataset.process="Prepare: 0%"}else if("closeBtn"===a){const e=t.parentNode;l.remClass(e,"visible")}}})},{"./a.js":1,"./b.js":2}]});